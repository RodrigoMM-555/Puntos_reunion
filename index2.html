<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PuntosReu</title>
<style>
    /* ====== ESTILO GENERAL ====== */
    body {
        font-family: "Segoe UI", Arial, sans-serif;
        margin: 0;
        padding: 20px;
        display: flex;
        background-color: #f4f6f8;
        color: #333;
    }

    footer button {
        position: fixed;   /* Fijo respecto a la ventana */
        bottom: 20px;      /* Separación desde abajo */
        right: 20px;        /* Separación desde la izquierda */
        z-index: 1000;     /* Para que quede por encima */
        max-width: 100px;
    }

    /* ====== COLUMNAS ====== */
    section#izquierda {
        width: 25%;
    }

    #izquierda article {
        padding: 20px;
        background-color: #ffffff;
        border-right: 1px solid #ddd;
        box-shadow: 2px 0 6px rgba(0,0,0,0.05);
        position: sticky;
        top: 20px;
        margin-bottom: 30px;
    }

    #izquierda article.encuesta{
        top: 190px;
        padding-top: 1px;
    }

    section#derecha {
        width: 75%;
        padding: 20px;
    }

    /* ====== BOTONES ====== */
    button {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        font-size: 14px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        background-color: #4f46e5;
        color: white;
        transition: background-color 0.2s ease;
    }

    button:hover {
        background-color: #4338ca;
    }

    button.eliminar {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        font-size: 14px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        background-color: #e54646;
        color: white;
        transition: background-color 0.2s ease;
    }

    button.eliminar:hover {
        background-color: #ca3838;
    }

    /* Botón guardar un poco diferente */
    .acciones button:last-child {
        background-color: #16a34a;
    }

    .acciones button:last-child:hover {
        background-color: #15803d;
    }

    /* ====== CONTENEDOR DE PUNTOS ====== */
    #contenedor {
        max-width: 800px;
        margin: 0 auto;
    }

    textarea.editor {
        width: 100%;                /* Siempre ocupa todo el ancho */
        max-width: 100%;            /* No se salga del contenedor */
        box-sizing: border-box;     /* Incluye padding en el ancho */
        min-height: 80px;
        padding: 8px;
        border-radius: 5px;
        border: 1px solid #ccc;
        resize: vertical;           /* Solo se puede cambiar altura */
        min-height: 250px;
    }

    /* Efecto al hacer foco */
    textarea.editor:focus {
        outline: none;
        border-color: #4f46e5;
    }

    /* ====== CADA PUNTO ====== */
    .punto {
        background-color: #ffffff;
        border-radius: 8px;
        margin-bottom: 15px;
        padding: 15px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.06);
    }

    /* ====== CABECERA / DRAG ====== */
    .handle {
        background-color: #e5e7eb;
        padding: 8px 10px;
        border-radius: 5px;
        cursor: grab;
        margin-bottom: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .handle h2 {
        margin: 0;
        font-size: 16px;
        color: #111827;
    }

    .handle select {
        padding: 5px 8px;          /* Espaciado interno */
        border-radius: 5px;         /* Bordes redondeados */
        border: 1px solid #ccc;     /* Borde gris claro */
        font-size: 13px;
        background-color: #f9f9f9;  /* Fondo suave */
        cursor: pointer;
    }

    /* Pequeño efecto al enfocar */
    .handle select:focus {
        outline: none;
        border-color: #4f46e5;      /* Borde azul */
    }

    .handle:active {
        cursor: grabbing;
    }

    /* ====== CONTENIDO ====== */
    .contenido {
        font-size: 14px;
        line-height: 1.5;
        margin-bottom: 10px;
    }

    /* ====== TEXTAREA EDICIÓN ====== */
    textarea {
        width: 100%;
        min-height: 80px;
        padding: 8px;
        font-family: inherit;
        font-size: 14px;
        border-radius: 5px;
        border: 1px solid #ccc;
        resize: vertical;
        margin-bottom: 10px;
    }

    textarea:focus {
        outline: none;
        border-color: #4f46e5;
    }

    /* ====== BOTONES DE ACCIÓN ====== */
    .acciones {
        display: flex;
        gap: 10px;
    }

    .acciones button {
        width: auto;
        flex: 1;
    }

    /* Encuesta */
    .barra {
        margin-bottom: 20px;
        height: 24px; /* un poco más alto para texto */
        transition: 0.5s;
        background: #25d366;
        border-radius: 5px;
        width: 0%;
        position: relative; /* necesario para posicionar el texto */
        color: white;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .barra .votos {
        position: absolute;
        width: 100%;
        text-align: center;
    }

    .encuesta button {
        display: flex;
        justify-content: space-between;
    }

</style>
</head>
<body>
    <section id="izquierda">
        <article>
            <button onclick="crearSeccion()">Crear punto</button>
            <button onclick="imprimir()">Imprimir</button>
        </article>
        <article class="encuesta">
                <h3>¿Cuál es tu lenguaje favorito?</h3>
            
                <div class="opcion">
                    <button onclick="votar(0)">Voy<span class="votos">0 votos</span></button>
                    <div class="barra" id="barra0">
                    </div>
                </div>
            
                <div class="opcion">
                    <button onclick="votar(1)">No voy<span class="votos">0 votos</span></button>
                    <div class="barra" id="barra1"></div>
                </div>
            
                <div class="opcion">
                    <button onclick="votar(2)">Llego tarde<span class="votos">0 votos</span></button>
                    <div class="barra" id="barra2"></div>
                </div>
        </article>
        
    </section>
    <section id="derecha">
        <div id="contenedor"></div>
        <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    </section>
</body>
<footer>
    <button onclick="eliminarTodos()"> Eliminar todos </button>
</footer>
<script>
    // Funcion para crear el punto
    function crearSeccion(){
        const titulo = prompt("Titulo del punto:");

        if (titulo === null || titulo.trim() === "") return;
        const seccion = document.createElement("section");

        seccion.className = "punto";

        seccion.innerHTML = `
            <div class="handle">
                <h2>☰ ${titulo}</h2>
                <form>
                    <select>
                        <option value="Cno">Comite no</option>
                        <option value="Csi">Comite si</option>
                    </select>
                </form>
            </div>
            <p class="contenido">Contenido del punto...</p>

            <textarea class="editor" style="display:none;"></textarea>

            <div class="acciones">
                <button onclick="editar(this)">Editar</button>
                <button onclick="this.closest('.punto').remove();" class="eliminar">Eliminar</button>
                <button onclick="guardar(this)" style="display:none;">Guardar</button>
            </div>
        `;

        document.getElementById("contenedor").appendChild(seccion);
    }
    // Funcion para editar el punto
    function editar(boton){
        const seccion = boton.closest(".punto");
        const contenido = seccion.querySelector(".contenido");
        const editor = seccion.querySelector(".editor");    // Area de texto a editar
        const BotonGuardar = seccion.querySelector("button[onclick='guardar(this)']"); // Boton guardar

        // Ocultamos el texto y mostramos el textarea
        contenido.style.display = "none";
        editor.style.display = "block";

        // Ocultamos botón editar y mostramos guardar
        boton.style.display = "none";
        boton.nextElementSibling.style.display = "none";    // Ocultamos eliminar
        BotonGuardar.style.display = "inline";
    }

    // Funcion para guardar el punto
    function guardar(boton){
        const seccion = boton.closest(".punto");
        const contenido = seccion.querySelector(".contenido");
        const editor = seccion.querySelector(".editor");    // Area de texto editada
        const BotonEditar = seccion.querySelector("button[onclick='editar(this)']");

        contenido.innerText = editor.value;

        // Volvemos a mostrar el texto y ocultar el textarea
        editor.style.display = "none";
        contenido.style.display = "block";

        // Mostramos editar y ocultamos guardar
        boton.style.display = "none";
        boton.previousElementSibling.style.display = "inline";  // Mostramos eliminar
        BotonEditar.style.display = "inline";
    }

    new Sortable(contenedor, {
        animation: 150,      // animación al mover
        handle: ".handle"    // zona desde donde se arrastra
    });

    function eliminarTodos() {
    if (confirm("¿Seguro que quieres eliminar todos los puntos?")) {
        document.getElementById("contenedor").innerHTML = "";
    }
    }

    // Encuesta
    let votos = [0, 0, 0];
    function votar(opcion) {
        votos[opcion]++;

        let total = votos.reduce((a, b) => a + b, 0);

        votos.forEach((voto, i) => {
            let porcentaje = (voto / total) * 100;
            const barra = document.getElementById("barra" + i);
            barra.style.width = porcentaje + "%";

            // Actualizamos el texto con número de votos y porcentaje
            barra.querySelector(".votos").innerText = `${voto} votos (${Math.round(porcentaje)}%)`;
        });
    }
</script>

<!-- Imprimir -->
<!-- AÑADE ESTE SCRIPT AL FINAL DE TU BODY O ANTES DE </body> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
function imprimir() {
    // Pedimos al usuario que escriba el título del PDF
    const tituloPDF = prompt("Introduce el título del PDF:");
    
    // Si no escribe nada o pulsa cancelar, salimos de la función
    if (!tituloPDF) return;

    // Inicializamos jsPDF
    // jsPDF nos permite crear documentos PDF directamente desde JS
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // Variable "y" para controlar la posición vertical en el PDF
    let y = 20; // comenzamos a 20 unidades desde arriba

    // Escribimos el título principal del PDF centrado
    doc.setFontSize(18); // tamaño de letra grande
    doc.text(tituloPDF, 105, y, { align: "center" }); // 105 = centro horizontal A4
    y += 15; // dejamos espacio después del título

    // Seleccionamos todos los puntos en orden del contenedor
    const puntos = document.querySelectorAll(".punto");
    doc.setFontSize(12); // tamaño de letra normal para los puntos

    // Recorremos cada punto
    puntos.forEach((punto, index) => {

        // Obtenemos el título del punto (quitando el icono ☰)
        const titulo = punto.querySelector(".handle h2").innerText.replace("☰ ", "");

        // Obtenemos el valor del select del punto
        const select = punto.querySelector(".handle select");
        const valor = select ? select.value : "Cno"; // si no hay select, asumimos "Cno"

        // Cambiamos el color del título según comité
        if (valor === "Csi") {
            doc.setTextColor(0, 128, 0); // verde para "Comité si"
        } else {
            doc.setTextColor(255, 0, 0); // rojo para "Comité no"
        }

        // Escribimos el título del punto en el PDF
        doc.text(`${index + 1}. ${titulo}`, 20, y); // 20 = margen izquierdo
        y += 7; // dejamos un pequeño espacio después del título

        // Obtenemos el contenido del punto
        const contenido = punto.querySelector(".contenido").innerText;

        // Ponemos el color negro para el contenido
        doc.setTextColor(0, 0, 0);

        // Ajustamos el texto a un ancho máximo de 170 unidades
        // splitTextToSize divide el texto en varias líneas si es demasiado largo
        const lines = doc.splitTextToSize(contenido, 170);

        // Escribimos cada línea del contenido en el PDF
        doc.text(lines, 25, y); // 25 = margen izquierdo para el contenido
        y += lines.length * 7 + 5; // avanzamos la posición vertical según el número de líneas

        // Si nos acercamos al final de la página (aprox 280 unidades),
        // añadimos una nueva página y reiniciamos "y"
        if (y > 280) {
            doc.addPage();
            y = 20;
        }
    });

    // Guardamos y descargamos el PDF con el nombre que escribió el usuario
    doc.save(`${tituloPDF}.pdf`);
}
</script>

</html>